<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gubby Clicker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow-y: auto;
            overflow-x: hidden;
            background-color: #f9fafb;
        }

        @keyframes sky-fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            95% { opacity: 1; }
            100% { transform: translateY(115vh) rotate(var(--sky-rotation)); opacity: 0; }
        }

        @keyframes text-pop {
            0% { opacity: 0; transform: translateY(0) scale(0.5); }
            20% { opacity: 1; transform: translateY(-30px) scale(1.2); }
            100% { opacity: 0; transform: translateY(-100px) scale(1); }
        }

        .animate-sky-fall {
            animation-name: sky-fall;
            animation-timing-function: linear;
            animation-fill-mode: forwards;
        }

        .animate-text-pop {
            animation: text-pop 1s ease-out forwards;
        }

        [data-lucide] {
            display: inline-block;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    iconRef.current.innerHTML = '';
                    const tempSpan = document.createElement('span');
                    tempSpan.setAttribute('data-lucide', name);
                    iconRef.current.appendChild(tempSpan);
                    window.lucide.createIcons({
                        attrs: { 
                            'stroke-width': 2,
                            width: size,
                            height: size,
                            class: className
                        }
                    });
                }
            }, [name, size, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center"></span>;
        };

        const App = () => {
            const [clicks, setClicks] = useState(0);
            const [gold, setGold] = useState(0);
            const [activeBuff, setActiveBuff] = useState(null);
            const [inventory, setInventory] = useState({ rainbow: 0, mega: 0, omega: 0 });
            const [textParticles, setTextParticles] = useState([]);
            const [notification, setNotification] = useState(null);
            const [imageError, setImageError] = useState(false);
            const [skyGubbies, setSkyGubbies] = useState([]);

            // Updated URL for Gubby (Wikia source)
            const gubbyImgUrl = "https://static.wikia.nocookie.net/parasprunki-fanon/images/1/1e/Gubby.webp";
            const goldCoinUrl = "https://cdn3d.iconscout.com/3d/premium/thumb/star-coin-3d-icon-png-download-11254734.png";
            const megaStarUrl = "https://static.vecteezy.com/system/resources/previews/018/842/628/non_2x/3d-star-icon-isolated-on-background-customer-rating-feedback-concept-3d-rendering-free-png.png";
            const omegaCrownUrl = "https://cdn3d.iconscout.com/3d/premium/thumb/king-crown-3d-icon-png-download-10707831.png";

            const SHOP_ITEMS = [
                { 
                    id: 'rainbow', 
                    name: 'Rainbow Charge', 
                    cost: 250, 
                    power: 10, 
                    duration: 30, 
                    img: 'https://cdn3d.iconscout.com/3d/premium/thumb/rainbow-3d-icon-png-download-4659629.png',
                    barColor: 'bg-pink-400' 
                },
                { 
                    id: 'mega', 
                    name: 'Mega Charge', 
                    cost: 750, 
                    power: 20, 
                    duration: 40, 
                    img: megaStarUrl,
                    barColor: 'bg-yellow-400' 
                },
                { 
                    id: 'omega', 
                    name: 'Omega Charge', 
                    cost: 2500, 
                    power: 100, 
                    duration: 30, 
                    img: omegaCrownUrl,
                    barColor: 'bg-orange-500' 
                }
            ];

            useEffect(() => {
                const spawnGubby = () => {
                    const id = Math.random().toString(36).substring(7);
                    const newGubby = {
                        id,
                        left: Math.random() * 100,
                        duration: 3.5 + Math.random() * 4,
                        size: 35 + Math.random() * 35,
                        rotation: Math.random() * 360,
                        delay: Math.random() * 2 
                    };
                    setSkyGubbies(prev => [...prev.slice(-40), newGubby]);
                    
                    const nextSpawn = 400 + Math.random() * 800;
                    setTimeout(spawnGubby, nextSpawn);
                };

                const timeout = setTimeout(spawnGubby, 500);
                return () => clearTimeout(timeout);
            }, []);

            useEffect(() => {
                if (!activeBuff) return;
                const timer = setInterval(() => {
                    setActiveBuff(prev => {
                        if (!prev || prev.timeLeft <= 1) return null;
                        return { ...prev, timeLeft: prev.timeLeft - 1 };
                    });
                }, 1000);
                return () => clearInterval(timer);
            }, [activeBuff]);

            const handleMainClick = () => {
                const gain = activeBuff ? activeBuff.multiplier : 1;
                setClicks(prev => prev + gain);
                
                const textId = Date.now() + Math.random();
                setTextParticles(prev => [...prev, { 
                    id: textId, 
                    x: 60 + (Math.random() * 20), 
                    y: (Math.random() - 0.5) * 40, 
                    value: gain 
                }]);
                
                setTimeout(() => {
                    setTextParticles(prev => prev.filter(p => p.id !== textId));
                }, 1000);
            };

            const sellClicks = () => {
                if (clicks === 0) return;
                setGold(prev => prev + clicks);
                setClicks(0);
            };

            const buyCharge = (item) => {
                if (gold >= item.cost) {
                    setGold(prev => prev - item.cost);
                    setInventory(prev => ({ ...prev, [item.id]: prev[item.id] + 1 }));
                } else {
                    setNotification({ title: "Insufficient Gold", message: `You need ${item.cost - gold} more gold to buy ${item.name}.`, type: "error" });
                }
            };

            const useCharge = (id) => {
                if (inventory[id] > 0) {
                    if (activeBuff) {
                        setNotification({ title: "Ability Active", message: "Wait for your current charge to finish first!", type: "warning" });
                        return;
                    }
                    const item = SHOP_ITEMS.find(i => i.id === id);
                    setInventory(prev => ({ ...prev, [id]: prev[id] - 1 }));
                    setActiveBuff({ id: item.id, multiplier: item.power, timeLeft: item.duration, name: item.name });
                } else {
                    setNotification({ title: "Out of Stock", message: `You don't have any ${id} charges. Check the Market!`, type: "warning" });
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center p-4 select-none relative">
                    <div className="fixed inset-0 pointer-events-none z-0">
                        {skyGubbies.map(gubby => (
                            <div key={gubby.id} className="absolute animate-sky-fall"
                                style={{
                                    left: `${gubby.left}%`,
                                    top: '-15%',
                                    width: `${gubby.size}px`,
                                    height: `${gubby.size}px`,
                                    animationDuration: `${gubby.duration}s`,
                                    animationDelay: `${gubby.delay}s`,
                                    '--sky-rotation': `${gubby.rotation}deg`
                                }}>
                                {!imageError ? (
                                    <img src={gubbyImgUrl} className="w-full h-full object-contain opacity-40" onError={() => setImageError(true)} />
                                ) : (
                                    <span style={{ fontSize: gubby.size }} className="opacity-40">üêü</span>
                                )}
                            </div>
                        ))}
                    </div>

                    {notification && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/30 backdrop-blur-sm">
                            <div className="bg-white border-2 border-slate-200 p-6 rounded-3xl max-w-sm w-full shadow-2xl">
                                <div className="flex justify-between items-start mb-4">
                                    <div className="flex items-center gap-2">
                                        <Icon name="AlertCircle" size={24} className={notification.type === 'error' ? 'text-red-500' : 'text-amber-500'} />
                                        <h4 className="font-bold text-lg text-[#111111] m-0 p-0">{notification.title}</h4>
                                    </div>
                                    <button onClick={() => setNotification(null)} className="p-1 hover:bg-gray-100 rounded-lg">
                                        <Icon name="X" size={20} />
                                    </button>
                                </div>
                                <p className="text-[#444444] mb-6 leading-relaxed m-0 p-0">{notification.message}</p>
                                <button onClick={() => setNotification(null)} className="w-full bg-[#333333] text-white py-3 rounded-xl font-bold uppercase tracking-widest hover:bg-[#111111] transition-colors">Close</button>
                            </div>
                        </div>
                    )}

                    <header className="z-20 w-full max-w-xl flex flex-col items-center gap-2 mt-4">
                        <h1 className="text-4xl font-black text-[#111111] tracking-tight text-center">Gubby Clicker</h1>
                        <div className="w-full flex flex-wrap justify-center items-center gap-4 bg-white/95 border border-slate-200 p-3 rounded-2xl shadow-lg backdrop-blur-md">
                            <div className="flex flex-col items-center px-4 border-r border-slate-100">
                                <span className="text-[10px] uppercase font-bold text-[#666666] tracking-widest">Clicks</span>
                                <span className="text-2xl font-black text-[#111111] leading-none">{clicks.toLocaleString()}</span>
                            </div>
                            <div className="flex flex-col items-center px-4 border-r border-slate-100">
                                <span className="text-[10px] uppercase font-bold text-[#666666] tracking-widest">Gold</span>
                                <div className="flex items-center gap-1 leading-none">
                                    <img src={goldCoinUrl} className="w-7 h-7 object-contain" alt="coin" />
                                    <span className="text-2xl font-black text-[#111111]">{gold.toLocaleString()}</span>
                                </div>
                            </div>
                            <button onClick={sellClicks} className="px-6 py-2 bg-yellow-400 text-black rounded-xl font-black hover:bg-yellow-300 active:scale-95 transition-all shadow-sm ml-2">Sell All</button>
                        </div>
                    </header>

                    <main className="z-10 relative flex flex-col items-center justify-center w-full min-h-[350px] my-6">
                        {activeBuff && (
                            <div className="absolute top-0 flex items-center gap-3 px-5 py-2.5 bg-white rounded-full border border-slate-100 shadow-lg animate-bounce z-30">
                                <Icon name="Timer" size={18} className="text-blue-600" />
                                <span className="font-bold text-sm">{activeBuff.name} active!</span>
                                <span className="bg-[#333333] text-white px-2 py-0.5 rounded-full text-xs font-bold">{activeBuff.timeLeft}s</span>
                            </div>
                        )}

                        <div className="relative w-52 h-52 sm:w-64 sm:h-64 flex items-center justify-center">
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full pointer-events-none z-20">
                                {textParticles.map(p => (
                                    <span key={p.id} className="absolute font-black text-6xl text-[#111111] animate-text-pop drop-shadow-md"
                                        style={{ left: `calc(50% + ${p.x}px)`, top: `calc(50% + ${p.y}px)` }}>
                                        +{p.value}
                                    </span>
                                ))}
                            </div>
                            <button onClick={handleMainClick} className="group relative w-full h-full active:scale-90 transition-all flex items-center justify-center outline-none z-10">
                                {!imageError ? (
                                    <img src={gubbyImgUrl} className="w-full h-full object-contain group-hover:scale-105 transition-transform" onError={() => setImageError(true)} />
                                ) : (
                                    <div className="text-9xl group-hover:scale-110 transition-transform">üêü</div>
                                )}
                            </button>
                        </div>
                        <div className="mt-4 z-10">
                            <p className="text-xs font-bold uppercase tracking-[0.2em] text-[#333333] bg-white/90 px-4 py-2 rounded-full border border-slate-100 shadow-sm">
                                Power: <span className="text-lg ml-1 text-black font-black">{activeBuff ? activeBuff.multiplier : 1}x</span>
                            </p>
                        </div>
                    </main>

                    <div className="z-20 w-full max-w-5xl grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                        <section className="bg-white border border-slate-100 p-6 rounded-[2rem] shadow-xl">
                            <h3 className="text-xs font-black uppercase tracking-widest mb-4 px-2 text-black">THE MARKET</h3>
                            <div className="space-y-3">
                                {SHOP_ITEMS.map(item => (
                                    <button key={item.id} onClick={() => buyCharge(item)} className="w-full flex items-center justify-between p-3 rounded-2xl bg-gray-50 hover:bg-slate-100 active:scale-[0.98] transition-all">
                                        <div className="flex items-center gap-4">
                                            <div className="aspect-square w-12 flex items-center justify-center bg-white border border-slate-100 shadow-sm rounded-xl p-2">
                                                <img src={item.img} className="w-full h-full object-contain" alt={item.name} />
                                            </div>
                                            <div className="text-left">
                                                <p className="text-lg font-black leading-none mb-1 text-black">{item.name}</p>
                                                <p className="text-xs text-[#666666] font-bold">{item.power}x Power ¬∑ {item.duration}s</p>
                                            </div>
                                        </div>
                                        <div className="bg-indigo-600 text-white px-4 py-2 rounded-xl text-center min-w-[90px] shadow-md">
                                            <p className="text-lg font-black leading-none">{item.cost.toLocaleString()}</p>
                                            <p className="text-[9px] font-bold uppercase mt-0.5 tracking-tighter opacity-70">Gold</p>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </section>

                        <section className="bg-white border border-slate-100 p-6 rounded-[2rem] shadow-xl flex flex-col">
                            <h3 className="text-xs font-black uppercase tracking-widest mb-6 px-2 text-black">INVENTORY</h3>
                            <div className="flex justify-around items-center flex-1 gap-4 py-4 px-2">
                                {SHOP_ITEMS.map(item => (
                                    <div key={`inv-container-${item.id}`} className="flex flex-col items-center gap-2 flex-1">
                                        <button 
                                            onClick={() => useCharge(item.id)} 
                                            className="relative aspect-square w-20 rounded-2xl flex flex-col items-center justify-center transition-all active:scale-90 bg-white border-2 border-slate-100 hover:border-slate-300 hover:bg-gray-50 shadow-sm p-3 group overflow-visible"
                                        >
                                            <div className="w-[80%] h-[80%] flex items-center justify-center mb-1">
                                                <img src={item.img} className="w-full h-full object-contain group-hover:scale-110 transition-transform" alt={item.id} />
                                            </div>
                                            <span className={`absolute -top-3 -right-3 px-2 py-1 min-w-[32px] rounded-xl flex items-center justify-center text-xs font-black border-2 border-white shadow-md ${inventory[item.id] > 0 ? 'bg-[#111111] text-white' : 'bg-gray-200 text-[#999999]'}`}>
                                                {inventory[item.id]}
                                            </span>
                                            <div className={`absolute bottom-1 w-8 h-1.5 rounded-full ${item.barColor}`} />
                                        </button>
                                        <span className="text-[10px] font-black uppercase text-[#333333] tracking-wider text-center max-w-[80px] leading-tight">
                                            {item.name.split(' ')[0]}
                                        </span>
                                    </div>
                                ))}
                            </div>
                        </section>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
